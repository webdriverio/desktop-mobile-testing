name: Tauri Linux Distro Package Tests

on:
  pull_request:
    paths:
      - 'packages/tauri-service/**'
      - 'fixtures/package-tests/tauri-app-linux-distros/**'
      - 'fixtures/package-tests/tauri-app/**'
      - '.github/workflows/test-tauri-webkit-e2e.yml'
  workflow_dispatch:

jobs:
  linux-distro-tests:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - distro: ubuntu
            version: "24.04"
            dockerfile: ubuntu.dockerfile

          - distro: fedora
            version: "40"
            dockerfile: fedora.dockerfile

          - distro: debian
            version: "12"
            dockerfile: debian.dockerfile

          - distro: centos-stream
            version: "9"
            dockerfile: centos-stream.dockerfile

          - distro: arch
            version: "latest"
            dockerfile: arch.dockerfile

          - distro: alpine
            version: "latest"
            dockerfile: alpine.dockerfile

          - distro: void
            version: "latest"
            dockerfile: void.dockerfile

    name: ${{ matrix.distro }}-${{ matrix.version }}

    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Run tests using test.sh
        run: |
          cd fixtures/package-tests/tauri-app-linux-distros
          ./test.sh ${{ matrix.distro }} test

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-${{ matrix.distro }}
          path: fixtures/package-tests/tauri-app/wdio-*.log
          if-no-files-found: ignore

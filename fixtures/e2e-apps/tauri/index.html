<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tauri Basic App</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .container {
        text-align: center;
        background: rgba(255, 255, 255, 0.1);
        padding: 2rem;
        border-radius: 1rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        font-weight: 300;
      }

      .counter-section {
        margin: 2rem 0;
      }

      #counter {
        font-size: 4rem;
        font-weight: bold;
        margin: 1rem 0;
        color: #61dafb;
      }

      button {
        padding: 12px 24px;
        font-size: 1.1rem;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        background: linear-gradient(45deg, #61dafb, #21a1f1);
        color: white;
        transition: all 0.3s ease;
        margin: 0.5rem;
        box-shadow: 0 4px 15px rgba(97, 218, 251, 0.3);
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(97, 218, 251, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      .info-section {
        margin-top: 2rem;
        font-size: 0.9rem;
        opacity: 0.8;
      }

      .status {
        margin-top: 1rem;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸš€ Tauri Basic App</h1>

      <div class="counter-section">
        <div id="counter">0</div>
        <button id="increment-button">Increment</button>
        <button id="decrement-button">Decrement</button>
        <button id="reset-button">Reset</button>
      </div>

      <div class="info-section">
        <p>This is a basic Tauri application for WebDriverIO testing.</p>
        <div class="status" id="status">Ready for testing</div>
      </div>
    </div>

    <script type="module">
      // Attach console to Tauri logger first so all logs are captured
      (async () => {
        try {
          const { attachConsole } = await import('@tauri-apps/plugin-log');
          await attachConsole();
          console.log('[App] Console attached to Tauri logger');
        } catch (error) {
          console.error('[App] Failed to attach console to Tauri logger:', error);
        }
      })();

      console.log('[App] Script loading started');
      console.log('[App] typeof window:', typeof window);
      console.log('[App] window.__TAURI__ available before plugin import:', typeof window.__TAURI__ !== 'undefined');

      // Import WebDriverIO Tauri plugin frontend API
      // This provides window.wdioTauri for testing
      import '@wdio/tauri-plugin';

      console.log('[App] Plugin imported');
      console.log('[App] window.wdioTauri available after import:', typeof window.wdioTauri !== 'undefined');

      // Import Tauri API using npm module approach (recommended for v2)
      // This is the preferred way in Tauri v2
      (async () => {
        console.log('[App] Starting Tauri API setup...');
        console.log('[App] window.__TAURI__ before setup:', window.__TAURI__);

        try {
          const { invoke } = await import('@tauri-apps/api/core');
          console.log('[App] Successfully imported @tauri-apps/api/core');

          // Ensure window.__TAURI__ exists and expose invoke for WebDriver tests
          if (!window.__TAURI__) {
            console.log('[App] Creating window.__TAURI__');
            window.__TAURI__ = {};
          }
          if (!window.__TAURI__.core) {
            console.log('[App] Creating window.__TAURI__.core');
            window.__TAURI__.core = {};
          }
          window.__TAURI__.core.invoke = invoke;
          console.log('[App] window.__TAURI__.core.invoke set successfully');
        } catch (error) {
          console.warn('[App] Failed to import @tauri-apps/api/core, using global API:', error);
          // Fallback: ensure window.__TAURI__.core.invoke exists (should be available with withGlobalTauri: true)
          if (!window.__TAURI__?.core?.invoke) {
            console.error('[App] Tauri API not available. Make sure withGlobalTauri is enabled in tauri.conf.json');
          } else {
            console.log('[App] Using global Tauri API');
          }
        }

        console.log('[App] Final window.wdioTauri check:', typeof window.wdioTauri !== 'undefined');
        console.log('[App] Final window.__TAURI__ check:', window.__TAURI__);
      })();

      let count = 0;
      const counterElement = document.getElementById('counter');
      const incrementButton = document.getElementById('increment-button');
      const decrementButton = document.getElementById('decrement-button');
      const resetButton = document.getElementById('reset-button');
      const statusElement = document.getElementById('status');

      function updateCounter() {
        counterElement.textContent = count;
        statusElement.textContent = `Counter: ${count}`;
      }

      function updateStatus(message) {
        statusElement.textContent = message;
      }

      incrementButton.addEventListener('click', () => {
        count++;
        updateCounter();
      });

      decrementButton.addEventListener('click', () => {
        count--;
        updateCounter();
      });

      resetButton.addEventListener('click', () => {
        count = 0;
        updateCounter();
      });

      // Initialize
      updateCounter();
      updateStatus('Application loaded successfully');

      // Test Tauri API availability
      if (window.__TAURI__) {
        updateStatus('Tauri API available - Ready for testing');
      } else {
        updateStatus('Tauri API not available - Running in browser mode');
      }
    </script>
  </body>
</html>
